# Конфигурация Django проекта

В этом документе описывается структура конфигурации Django проекта. Конфигурация организована модульным способом для лучшей поддерживаемости и разделения ответственности.

## Структура директорий

```
src/config/
├── patterns/
|   ├── __init__.py      # Инициализация пакета
│   ├── base.py          # Базовые URL паттерны
│   ├── development.py   # Настройки для разработки
│   ├── local.py         # Агрегатор локальных настроек
│   └── production.py    # Настройки для продакшена
|
├── settings/
|   ├── _init__.py       # Инициализация пакета
│   ├── apps.py          # Конфигурация приложений и middleware
│   ├── auth.py          # Настройки аутентификации и авторизации
│   ├── base.py          # Базовые настройки проекта
│   ├── database.py      # Конфигурация базы данных
│   ├── localization.py  # Настройки языка и временной зоны
│   ├── logger.py        # Конфигурация логирования
│   ├── server.py        # Настройки серверного процесса
│   ├── smtp.py          # Настройки электронной почты
│   ├── static.py        # Конфигурация статических и медиа файлов
│   └── templates.py     # Конфигурация шаблонов и WSGI/ASGI
|
├── _init__.py          # Инициализация пакета
├── auto_config.py      # Утилиты автоматизации для обнаружения приложений
├── asgi.py             # Конфигурация ASGI
├── env.py              # Обработчик переменных окружения
├── urls.py             # Основная конфигурация URL
├── wsgi.py             # Конфигурация WSGI
└── yasg.py             # Настройка документации Swagger/OpenAPI
```

## Основные компоненты

### Паттерны окружения

- **Настройки разработки** (`patterns/development.py`): Конфигурация для среды разработки
- **Настройки продакшена** (`patterns/production.py`): Конфигурация для продакшен-среды
- **Локальные настройки** (`patterns/local.py`): Объединяет все модули настроек

### Основные настройки

1. **Приложения** (`settings/apps.py`)
   - Автоматическое обнаружение приложений из основных и внешних модулей
   - Конфигурация встроенных приложений Django
   - Настройка middleware

2. **Аутентификация** (`settings/auth.py`)
   - Валидация паролей
   - Настройки JWT аутентификации
   - Ограничение частоты запросов
   - Настройки безопасности Swagger

3. **База данных** (`settings/database.py`)
   - Конфигурация PostgreSQL
   - Обработка ошибок подключения
   - Настройки автоматических полей

4. **Статические файлы** (`settings/static.py`)
   - Конфигурация статических файлов
   - Настройки медиа файлов
   - Настройка директории для логов
   - Конфигурация Whitenoise

5. **Локализация** (`settings/localization.py`)
   - Языковые настройки
   - Конфигурация временных зон
   - Параметры интернационализации

### Серверная конфигурация

- **ASGI** (`asgi.py`): Настройка асинхронного серверного шлюза
- **WSGI** (`wsgi.py`): Настройка веб-серверного шлюза
- **Настройки сервера** (`settings/server.py`): Конфигурация серверного процесса

### Документация API

- **Swagger/OpenAPI** (`yasg.py`): Настройка документации API с точками доступа:
  - `/swagger.json` или `/swagger.yaml` для схемы
  - `/swagger/` для Swagger UI
  - `/redoc/` для ReDoc интерфейса

### Утилиты автоматизации

`auto_config.py` предоставляет утилиты для:
- Автоматического обнаружения установленных приложений
- Обнаружения URL паттернов для внешних модулей
- Валидации конфигурации приложений

## Переменные окружения

Проект использует `django-environ` для управления переменными окружения. Файл `.env` должен находиться в корневой директории проекта. Основные переменные окружения включают:

```
API_SECRET_KEY            # Секретный ключ API
API_ALLOWED_HOSTS         # Разрешенные хосты
API_HOST                  # Хост API
API_PORT                  # Порт API

DB_NAME                   # Имя базы данных
DB_USER                   # Пользователь БД
DB_PASSWORD               # Пароль БД
DB_HOST                   # Хост БД
DB_PORT                   # Порт БД

EMAIL_HOST               # SMTP хост
EMAIL_PORT               # SMTP порт
EMAIL_USE_TLS            # Использование TLS
EMAIL_HOST_USER          # Пользователь SMTP
EMAIL_HOST_PASSWORD      # Пароль SMTP

SYSTEM_TITLE            # Название системы
```

## Конфигурация URL

Маршрутизация URL организована в слоях:
1. Базовые паттерны (`patterns/base.py`)
2. Маршруты API (`urls.py`)
3. Автоматически обнаруженные маршруты внешних модулей

## Логирование

Конфигурация логирования (`settings/logger.py`) обеспечивает:
- Логирование в файл
- Вывод в консоль
- Различные форматтеры для разных нужд логирования
- Отдельные логгеры для Django и стандартных функций

## Использование

1. Создайте файл `.env` в корне проекта с необходимыми переменными окружения
2. Выберите подходящий паттерн настроек:
   - `development.py` для разработки
   - `production.py` для продакшена
3. Внешние модули должны быть размещены в директории, указанной в `EXTERNAL_MODULES_DIR`
4. Выполните миграции и соберите статические файлы перед развертыванием

## Примечания по безопасности

- JWT аутентификация настроена с настраиваемым временем жизни токенов
- Реализовано ограничение частоты запросов для анонимных и аутентифицированных пользователей
- Правильно настроен CORS middleware
- Включена безопасная валидация паролей
- Режим отладки отключен в продакшен-настройках